<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - DLInventoryApp</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/DLInventoryApp.styles.css" asp-append-version="true" />
</head>
<body>
    <header class="border-bottom mb-3">
        <nav class="container d-flex align-items-center justify-content-between py-2">

            <div>
                <a asp-controller="Inventories" asp-action="Index" class="fw-bold text-decoration-none">
                    DLInventory
                </a>
            </div>

            <div class="d-flex gap-3">
                <a asp-controller="Inventories" asp-action="Index">All Inventories</a>

                @if (User.Identity != null && User.Identity.IsAuthenticated)
                {
                    <a asp-controller="Inventories" asp-action="My">My Inventories</a>
                }
            </div>

            <div>
                <form asp-controller="Search" asp-action="Index" method="get" class="d-flex gap-2 position-relative" autocomplete="off">
                    <div class="position-relative" style="width: 420px;">
                        <input type="text"
                               id="searchBox"
                               name="query"
                               placeholder="Search..."
                               class="form-control form-control-sm"
                               value="@Context.Request.Query["query"]"/>

                        <div id="searchSuggest"
                             class="position-absolute start-0 mt-1 w-100 bg-white border rounded shadow-sm"
                             style="display:none; z-index: 2000;"></div>
                    </div>

                    <button type="submit" class="btn btn-sm btn-outline-primary">Search</button>
                </form>
            </div>

            <div>
                <partial name="_LoginPartial" />
            </div>

        </nav>
    </header>
    <div class="container">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>
    <footer class="border-top footer text-muted">
        <div class="container">
            &copy; 2026 - DLInventoryApp
        </div>
    </footer>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>

<script>
        (function () {
      const input = document.getElementById("searchBox");
      const box = document.getElementById("searchSuggest");

      if (!input || !box) return;

      const MIN_LEN = 2;
      const DEBOUNCE_MS = 300;
      let timer = null;
      let lastQuery = "";
      let controller = null;

      function hide() {
        box.style.display = "none";
        box.innerHTML = "";
      }

      async function loadSuggest(q) {
        if (controller) controller.abort();
        controller = new AbortController();

        const url = `/Search/Suggest?query=${encodeURIComponent(q)}`;

        const resp = await fetch(url, {
          method: "GET",
          headers: { "X-Requested-With": "XMLHttpRequest" },
          signal: controller.signal
        });

        if (!resp.ok) {
          hide();
          return;
        }

        const html = await resp.text();
        box.innerHTML = html.trim();

        if (box.innerHTML.length === 0) {
          hide();
        } else {
          box.style.display = "block";
        }
      }

      input.addEventListener("input", function () {
        const q = (input.value || "").trim();

        if (q.length < MIN_LEN) {
          lastQuery = "";
          hide();
          return;
        }
        if (q === lastQuery) return;
        lastQuery = q;

        clearTimeout(timer);
        timer = setTimeout(() => {
          loadSuggest(q).catch(() => {});
        }, DEBOUNCE_MS);
      });

      document.addEventListener("click", function (e) {
        if (e.target === input || box.contains(e.target)) return;
        hide();
      });
      input.addEventListener("keydown", function (e) {
        if (e.key === "Escape") hide();
      });
    })();
</script>