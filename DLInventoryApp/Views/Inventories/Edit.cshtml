@using DLInventoryApp.ViewModels.Inventories
@model EditInventoryVm

<h2>Edit Inventory</h2>

<form asp-action="Edit" method="post">
    @Html.AntiForgeryToken()

    <input type="hidden" asp-for="InventoryId" />

    <div>
        <label asp-for="Title"></label>
        <input asp-for="Title" />
        <span asp-validation-for="Title"></span>
    </div>

    <div>
        <label asp-for="Description"></label>
        <textarea asp-for="Description"></textarea>
        <span asp-validation-for="Description"></span>
    </div>

    <div>
        <input asp-for="IsPublic" type="checkbox" />
        <label asp-for="IsPublic"></label>
    </div>

    <div>
        <label asp-for="CategoryId"></label>
        <input asp-for="CategoryId" />
        <span asp-validation-for="CategoryId"></span>
    </div>

    <hr />

    <div>
        <label>Tags</label>

        <div style="display:flex; gap:8px; align-items:center;">
            <input type="text" id="tagInput" placeholder="type tag and press Add" />
            <button type="button" id="addTagBtn">Add</button>
        </div>

        <div id="tagsChips" style="margin-top:10px; display:flex; gap:6px; flex-wrap:wrap;"></div>
        <div id="tagsHidden"></div>
    </div>

    <button type="submit">Save</button>
</form>

@section Scripts {
    <script>
        (function () {
            const input = document.getElementById("tagInput");
            const addBtn = document.getElementById("addTagBtn");
            const chips = document.getElementById("tagsChips");
            const hidden = document.getElementById("tagsHidden");

            const tags = new Set();

            function normalize(v) {
                return (v || "").trim().toLowerCase();
            }

            function render() {
                chips.innerHTML = "";
                hidden.innerHTML = "";

                tags.forEach(t => {
                    const chip = document.createElement("span");
                    chip.textContent = t;
                    chip.style.padding = "4px 8px";
                    chip.style.background = "#eee";
                    chip.style.borderRadius = "14px";
                    chip.style.display = "inline-flex";
                    chip.style.gap = "6px";
                    chip.style.alignItems = "center";

                    const x = document.createElement("button");
                    x.type = "button";
                    x.textContent = "×";
                    x.style.border = "none";
                    x.style.background = "transparent";
                    x.style.cursor = "pointer";
                    x.onclick = () => { tags.delete(t); render(); };

                    chip.appendChild(x);
                    chips.appendChild(chip);

                    const h = document.createElement("input");
                    h.type = "hidden";
                    h.name = "Tags";
                    h.value = t;
                    hidden.appendChild(h);
                });
            }

            function addTag() {
                const t = normalize(input.value);
                if (!t) return;
                tags.add(t);
                input.value = "";
                render();
            }

            addBtn.addEventListener("click", addTag);
            input.addEventListener("keydown", e => {
                if (e.key === "Enter") {
                    e.preventDefault();
                    addTag();
                }
            });

            const initial = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Tags ?? new List<string>()));
            initial.forEach(t => {
                const n = normalize(t);
                if (n) tags.add(n);
            });
            render();
        })();
    </script>
}